---
title: "Merge algorithms (작성 중)"
category: LLM / Multimodal
tag: Multimodal
---







* 목차
{:toc}










Model merging 기법은 여러 모델을 하나의 모델로 결합하는 기술이다. 최근 [open llm leaderboard](https://huggingface.co/spaces/open-llm-leaderboard/open_llm_leaderboard)에도 많은 merge model들이 올라오고 있다. Mergekit 혹은 LazyMergekit을 통해 간편히 Model merge를 할 수 있다.



# 1. Task Vector Arithmetic

# 2. SLERP

Spherical Linear Interpolation (SLERP)는 두 vector에 대한 부드러운 interpolate(보간법/내삽)을 위해 사용되는 방법이다. 이는 고차원 공간에서 두 모델의 고유한 특성과 곡률을 보존하면서 모델을 혼합시킨다.

> interpolate<br>
> 데이터 지점의 고립점 내에서 새로운 데이터 지점을 구성하는 방식

- 구현 단계
  <center><img width="800" src="https://github.com/finddme/finddme.github.io/assets/53667002/f3182c6f-7acc-4fd7-a2ff-0ab6bbd4985c"></center>
  
  1. **Normalization** : vector의 크기보다는 방향에 집중하여 정규화 하기 위해 입력 벡터를 단위 길이로 정규화한다. <br>
                    가중치 방향의 변화는 변화의 크기보다 더 의미 있는 정보(feature learning, representation 등)를 나타내는 경우가 많다.
  2. **Angle Calculation** : vector의 dot product(내적)을 통해 두 vector 간의 각도를 계산한다. interpolation factor(보간 계수)와 vector 간의 각도를 기반으로 scale factor(scale 계수)를 계산한다.
  3. **Vector Weighing and Summation** : 계산된 계수로 기존 vector를 가중하고, 이를 합산하여 보간된 vector를 구한다.

- 장점
  - Smooth Transitions : 부드러운 parameter 전환. 고차원 vector interpolate 시 부드럽게 parameter를 전환시킨다.
  - Preservation of Characteristics : SLERP은 모델의 특성을 잘 보존하며 결합이 진행된다. 즉, 결합하는 모델들의 고유한 특성과 곡률을 유지한다.
  - Nuanced Blending : 세밀한 혼합이 가능하다. vector space의 여러 속성들을 고려하여 두 모델의 특성을 세밀하게 반영하여 혼합한다.

- 단점
  - 한번에 두 모델만 결합할 수 있다.

[EmbeddedLLM/Mistral-7B-Merge-14-v0.1](https://huggingface.co/EmbeddedLLM/Mistral-7B-Merge-14-v0.1)에서 시도된 것처럼 계층적으로 둘 이상의 모델을 결합할 수도 있다. 해당 모델의 merge.yml은 [https://huggingface.co/EmbeddedLLM/Mistral-7B-Merge-14-v0.1/blob/main/merge.yml](https://huggingface.co/EmbeddedLLM/Mistral-7B-Merge-14-v0.1/blob/main/merge.yml)에서 확인 가능하다. .yml 파일에서 $t$는 보간 계수이다.
 
# 3. TIES
# 4. DARE
# 5. Passthrough
# 6. MoE

# Reference

> [Geometric Algebra - Linear and Spherical Interpolation (LERP, SLERP, NLERP)](https://www.youtube.com/watch?v=ibkT5ao8kGY)
> https://slgero.medium.com/merge-large-language-models-29897aeb1d1a
