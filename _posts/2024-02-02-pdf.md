---
title: PDF Parsing 실험 일지(작성 중)
category: Dev Log
tag: Development
---







* 목차
{:toc}











실험 대상 pdf는 [우리은행 (20240603) 금융시장 브리프.pdf](https://www.wfri.re.kr/ko/web/research_report/research_report.php?idx=1409&page_type=view&mode=view&page=&page_limit=&search_key=front&search_type=card)로, Google에 "금융보고서"를 검색하여 랜덤하게 다운받은 pdf이다. 해당 pdf에서 차트와 표 그리고 텍스트가 고루 포함된 페이지를 대표 실험 대상으로 삼음. 해당 보고서 내용과 본 포스트는 무관함.


# 1. PDF Layout detection
## 1.1 Detectron2 

- Pirma가 가장 나음
- Detectron2 모델 사용에 필요한 layoutparser에서 제공하는 text extraction 모듈 TesseractAgent가 한국어를 지원하지 않아 text 추출이 제대로 되지 않음
- Detectron2로는 text 위치만 파악하고, 얻어진 bbox를 활용하여 다른 text 추출 라이브러리 혹은 모델을 사용해야 할 것 같음
- 다른 detection label이 함께 추출되어 layout만 잘 감지한다면 pdf 구조화 시 custom이 용이할 것으로 보임.
  e.g. Pirma label {1:"Page Frame", 2:"Row", 3:"Title Region", 4:"Text Region", 5:"Title", 6:"Subtitle", 7:"Other"}
  
[modelzoo](https://layout-parser.readthedocs.io/en/latest/notes/modelzoo.html)에서 확인 가능

### 1.1.1 Pirma 

- Pirma output 시각화 
  
<center><img width="1000" src="https://github.com/finddme/finddme.github.io/assets/53667002/1821352a-172a-45d8-8e49-5a3f27fee54c"></center>
<center><em style="color:gray;">표가 그림으로 삽입된 페이지    |    표가 문서 내 표로 삽입된 페이지</em></center><br>

### 1.1.2 HJDataset 

- HJDataset output 시각화
  
<center><img width="1000" src="https://github.com/finddme/finddme.github.io/assets/53667002/59fc5431-4e83-4684-8508-b70694a255a8"></center>
<center><em style="color:gray;">표가 그림으로 삽입된 페이지    |    표가 문서 내 표로 삽입된 페이지</em></center><br>


### 1.1.3 PubLayNet 

- PubLayNet output 시각화
  
<center><img width="800" src="https://github.com/finddme/finddme.github.io/assets/53667002/4425c28b-dcbd-48aa-9155-1846cf6fbec6"></center>
<center><em style="color:gray;">표가 그림으로 삽입된 페이지    |    표가 문서 내 표로 삽입된 페이지</em></center><br>

## 1.2 PDF to XML 

PDF 구조를 XML로 변경하여 layout 파악(PDFQuery 사용)

### 1.2.1 PDF to XML 시각화

- 표가 그림으로 삽입된 페이지
  
<center><img width="1000" src="https://github.com/finddme/finddme.github.io/assets/53667002/d308b4d6-40a3-4b54-b1a5-5d9be829e3a0"></center>
<center><em style="color:gray;">표가 그림으로 삽입된 페이지    |    표가 문서 내 표로 삽입된 페이지</em></center><br>


### 1.2.2 PDF to xml을 통해 감지된 bbox 내 text 추출

- PyMuPDF
  
  - 일반 text는 대부분 잘 추출하는 편. 
  - 표가 그림으로 삽입된 페이지의 table data 추출 못함.
  - 표가 문서 내 표로 삽입된 페이지의 table data의 경우 텍스트는 추출되지만 정리되지 않음.

<center><img width="1000" src="https://github.com/finddme/finddme.github.io/assets/53667002/3e36c2d1-f946-481f-8191-4fdaa9da198c"></center>
<center><em style="color:gray;">표가 그림으로 삽입된 페이지    |    표가 문서 내 표로 삽입된 페이지</em></center><br>

# 2. PDF text extraction
## 2.1 PDF to markdown(Rule base)
- huggingface demo: https://huggingface.co/spaces/huggingchat/pdf-to-markdown
pypdf.PdfReader
ocrmypdf

# 3. PDF table extraction
테이블데이터 추출

## 3.1 camelot-py

- 표가 그림으로 삽입된 페이지
  - 테이블 감지는 잘 됨
  - 테이블 내 text 추출이 잘 되지 않음
  - 아래 그림을 보면 표 위치에서 감지하는 text가 없음
  
<center><img width="600" src="https://github.com/finddme/finddme.github.io/assets/53667002/0ee5fa6c-58c9-490f-90b7-d456fc2a0a46"></center>
<center><em style="color:gray;">camelot-py table detection result(Illustrated by the author)</em></center><br>

 <center><img width="200" src="https://github.com/finddme/finddme.github.io/assets/53667002/6ae76d66-1b76-4772-9f27-c3d6822b0b48"></center>
<center><em style="color:gray;">camelot-py table text extraction</em></center><br> 

- 표가 문서 내 표로 삽입된 페이지
  - 테이블 감지 잘 됨
  - 테이블 내 text 가 추출 됨. 추가 후처리 모듈을 붙이면 깔끔하게 나올 것 같음

    
<center><img width="600" src="https://github.com/finddme/finddme.github.io/assets/53667002/5d532cd8-99ff-47b8-8584-8d82ca7a877f"></center>
<center><em style="color:gray;">camelot-py table detection result(Illustrated by the author)</em></center><br>

 <center><img width="1000" src="https://github.com/finddme/finddme.github.io/assets/53667002/9dcfcab6-6322-42ba-9d37-ab3615232def"></center>
<center><em style="color:gray;">camelot-py table text extraction</em></center><br> 

## 3.2 pdfplumber

- 표가 그림으로 삽입된 페이지는 추출되는 text가 없음
- 표가 표로 삽입된 페이지는 아래와 같이 잘 추출됨.

 <center><img width="1000" src="https://github.com/finddme/finddme.github.io/assets/53667002/02e46247-604d-4edc-85a2-1599fa1be177"></center>
<center><em style="color:gray;">pdfplumber table text extraction</em></center><br> 


# 4. SwinTransformer Encoder - BART Decoder (Donut / Nougat)

Encoder로 layout detection 후 Decoder로 bounding box 내부 text 추출하는 모델 

- Donut Github: https://github.com/clovaai/donut/
- Nougat Github: https://github.com/facebookresearch/nougat/tree/main?tab=readme-ov-file
  
## 4.1 Donut (naver clovaai)
<center><img width="1000" src="https://github.com/finddme/finddme.github.io/assets/53667002/6777cf3a-9479-4675-bf95-8a0df67d1a2f"></center>
<center><em style="color:gray;">Donut text extraction result</em></center><br>

추출되는 것이 거의 없음 

## 4.2 Nougat (meta)

추출되는 것이 전혀 없음

## 4.3 보강 방안

두 모델 모두 한국어 text 추출에 취약함. 

SwinTransformer로 bbox 특정 후 아래 두 방법으로 한국어 추출 문제를 완화할 수 있을 것으로 보임

- Decoder가 하는 역할을 Rulbase 한국어 추출을 잘 하는 라이브러리로 text를 따로 추출하는 방법
- Decoder model을 변경하여 


